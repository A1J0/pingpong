<!DOCTYPE html>
<html>
	<head>
		<title>Ping Pong</title>
		<style>
			canvas{
			border: 1px solid red;
		}
		</style>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	</head>
	<body>
		<canvas id="canvas" width="640" height="480">
		</canvas>
		<script>
		var gameCanvas = document.getElementById('canvas');
		var ctx = gameCanvas.getContext('2d');
		var height = gameCanvas.height;
		var width = gameCanvas.width;
		var ball = {
			x: 0,
			y: 0,
			height: 30,
			width: 30,
			color: '#ffffff',
			vx:1,
			vy:1,
			angle: 0,
			draw: function(canvas){
				canvas.fillRect(this.x - (this.width/2),this.y - (this.height/2),this.width,this.height);
			},
			spin: function(){

			},
			animate: function(canvas,objs){
				this.detectCollision(canvas,objs);
				this.x += this.vx;
				this.y += this.vy;
			},
			setPosition: function(_x,_y){
				this.x = _x;
				this.y = _y;
			},
			detectCollision: function(canvas,objs){
				//Check if canvas borders are collided.
				var bounce = {
					x:0,
					y:0
				};



				if(this.x <= (ball.width/2) + 30){
					if(Math.pow(Math.pow(peddles[0].y - this.y ,2),0.5) <= (peddles[0].height/2) + (this.y/2) )
					{
						this.vx = 1;
					}
				}
				else if(this.x >= ((width - 30) - (ball.width/2))){
					if(Math.pow(Math.pow(peddles[1].y - this.y ,2),0.5) <= (peddles[0].height/2) + (this.y/2) )
					{
						this.vx = -1;
					}
				}
				/*else
				{
					//Check object collisions
					for (var i = peddles.length - 1; i >= 0; i--) {
						var xpos = 1, ypos = 1;
						var x_distance = (this.x - peddles[i].x);
						var y_distance = (this.y - peddles[i].y);

						if(Math.pow(Math.pow(x_distance,2),0.5) < (this.width/2 + peddles[i].width/2))
						{
							if(Math.pow(Math.pow(y_distance,2),0.5) < (this.height/2 + peddles[i].height/2))
							{
								if(x_distance < 0){
									xpos = -1;
								}
							}
							this.vx = xpos;	
						}
					};
				}*/

				if(this.y <= ball.height/2){
					this.vy = 1;
				}
				else if(this.y >= (height - (ball.height/2))){
					this.vy = -1;
				}
			}
		}
		var paddel =  function(canvas,x_pos){
			this.color = "#ffffff";
			this.height = 120;
			this.width = 30;
			this.x = x_pos;
			this.y = this.height/2;
			this.draw = function (){
				canvas.fillRect(this.x - (this.width/2),this.y - (this.height/2),this.width,this.height);
			},
			this.move = function(direction){
				switch(direction){
					case 1:
						this.y += 3;
					break;
					case 0:
						this.y -= 3;
					break;
				}
			}
		};

		var peddles = [];

		function init(){
			ball.setPosition(width/2, height/2);
			peddles.push(new paddel(ctx,15));
			peddles.push(new paddel(ctx,width - 15));
		}
		init();

		function gameAction(){
			ball.animate(ctx,peddles);
		}

		function gameLoop(){
			gameAction();

			//Clear canvas
			ctx.clearRect(0,0,width,height);

			//Draw objects
			ball.draw(ctx);
			for (var i = peddles.length - 1; i >= 0; i--) {
				peddles[i].draw(ctx);
			};
		}

		setInterval(gameLoop,10);

		$(document).keydown(function (event) {
	      var key = event.which;
	      	switch(key){
	      		case 38:
	      			peddles[1].move(0);
	      		break;

	      		case 40:
	      			peddles[1].move(1);
	      		break;

	      		case 87:
	      			peddles[0].move(0);
	      		break;

	      		case 83:
	      			peddles[0].move(1);
	      		break;

	      	}
	    });
		</script>
	</body>
</html>