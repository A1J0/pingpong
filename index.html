<!DOCTYPE html>
<html>
	<head>
		<title>Ping Pong</title>
		<style>
			canvas{
			border: 1px dotted red;
		}
		#canvas-container{
			width: 100%;
			text-align: center;
		}
		</style>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	</head>
	<body>
		<div id = "canvas-container">
		<canvas id="canvas" width="640" height="480">
		</canvas>
	</div>
		<script>
		var gameCanvas = document.getElementById('canvas');
		var ctx = gameCanvas.getContext('2d');
		var height = gameCanvas.height;
		var width = gameCanvas.width;
		var keysDown = {};
		var score1=0,score2=0,miss1=0,miss2=0;
		var ball = {
			x: 0,
			y: 0,
			height: 30,
			width: 30,
			color: '#ffffff',
			vx:1, //vectorX
			vy:1, //vectorY
			angle: 0,
			draw: function(canvas){//drawing function for ball object
				canvas.fillRect(this.x - (this.width/2),this.y - (this.height/2),this.width,this.height); //ball center point
			},
		 	animate: function(canvas,objs){
				this.detectCollision(canvas,objs);
				this.x += this.vx; //speed x
				this.y += this.vy;//speed y
			},
			setPosition: function(_x,_y){//setting position on canvas _x,_y parameters
				this.x = _x; //ball position x
				this.y = _y; //ball position y
			},
			detectCollision: function(canvas,objs){
				//Check if canvas borders are collided.
				
				if(this.x <= (ball.width/2) + 30){
					if(peddles[0].y + (peddles[0].height/2) > this.y && peddles[0].y - (peddles[0].height/2) < this.y)
					{
						this.vx = 1;
						score1++;
						console.log(score1);
					}
				}
				else if(this.x >= ((width - 30) - (ball.width/2))){
					if(peddles[1].y + (peddles[1].height/2) > this.y && peddles[1].y - (peddles[1].height/2) < this.y)
					{
						this.vx = -1;
						score2++;
						console.log(score2);
					}
				}
	
				if(this.x > peddles[1].x + (ball.width/2)){;
					miss2++;
					console.log(miss2);
					ball.setPosition(width/2,height/2);
					//miss1 = 0;
					//miss2 = 0;
					score1 = 0;
					score2 = 0;
				}		
				if(this.x < peddles[0].x - (ball.width/2)){
					miss1++
					console.log(miss1);
					ball.setPosition(width/2,height/2);
					//miss1 = 0;
					//miss2 = 0;
					score1 = 0;
					score2 = 0;
				}

				if(this.y <= ball.height/2){
					this.vy = 1;
				}
				else if(this.y >= (height - (ball.height/2))){
					this.vy = -1;
				}
			}
		}
		var paddel =  function(canvas,x_pos){
			this.color = "#ffffff";
			this.height = 120;
			this.width = 30;
			this.x = x_pos;
			this.y = this.height/2;
			this.draw = function (){
				canvas.fillRect(this.x - (this.width/2),this.y - (this.height/2),this.width,this.height);
			},
			this.move = function(direction){
				switch(direction){
					case 1:
						if(this.y < 480)
						{
							this.y += 3;
						}							
						break;
					case 0:
						if(this.y >	0)
						{
							this.y -= 3;
						}
					break;
				}
			}
		};

		var peddles = [];


		function init(){
			ball.setPosition(width/2, height/2);
			peddles.push(new paddel(ctx,15));
			peddles.push(new paddel(ctx,width - 15));
		}
		init();

		function gameAction(){
			ball.animate(ctx,peddles);
		}

		function gameLoop(){
			keyUpdate();
			gameAction();

			//Clear canvas
			ctx.clearRect(0,0,width,height);

			//Draw objects
			ball.draw(ctx);
			for (var i = peddles.length - 1; i >= 0; i--) {
				peddles[i].draw(ctx);
			};
		}

		setInterval(gameLoop,10);

		
		window.addEventListener('keydown', function(e) {
			    keysDown[e.keyCode] = true;
		});
		window.addEventListener('keyup', function(e) {
			    delete keysDown[e.keyCode];
		});

		function keyUpdate() {
		    if (87 in keysDown) {
		        peddles[0].move(0);
		    }
		    if (38 in keysDown) {
		        peddles[1].move(0);
		    }
		    if (83 in keysDown) {
		        peddles[0].move(1);
		    }
		    if (40 in keysDown) {
		        peddles[1].move(1);
		    }
		}
		</script>
	</body>
</html>